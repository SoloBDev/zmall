graph TD
    subgraph TIER1[" "]
        direction TB
        T1_Title["<b>TIER 1: CLIENTS & EXTERNAL</b>"]

        subgraph ExtConn["External Connections"]
            Internet["‚òÅÔ∏è INTERNET<br/>üì± Mobile Devices<br/>üí≥ POS Machines"]
        end

        subgraph PaymentGateways["Payment & External Services"]
            PG["üè¶ <b>Payment Gateways</b><br/>‚Ä¢ Telebirr InApp<br/>‚Ä¢ Chapa<br/>‚Ä¢ EthSwitch<br/>‚Ä¢ Addis Pay<br/>‚Ä¢ Amole<br/>‚Ä¢ Yagout Pay<br/>‚Ä¢ CBE USSD<br/>‚Ä¢ Dashen Bank<br/>‚Ä¢ Etta Card<br/>‚Ä¢ SantiM Pay<br/>‚Ä¢ CyberSource"]
        end

        subgraph GoogleSocial["Google Services & Social"]
            GS["‚Ä¢ Google Maps API<br/>‚Ä¢ Google OAuth<br/>‚Ä¢ Facebook Analytics<br/>‚Ä¢ Facebook App Events"]
        end

        %% Internal connections in TIER 1
        Internet --> PaymentGateways
        Internet --> GoogleSocial
    end

    subgraph TIER2[" "]
        direction TB
        T2_Title["<b>TIER 2: BACKEND SERVERS</b>"]

        subgraph ZMallServer["üñ•Ô∏è ZMall Server Main Backend"]
            ServerURLs["‚Ä¢ Production: http://196.188.187.43:8000<br/>‚Ä¢ Test: http://196.189.44.49:7000"]

            APIs["<b>REST API Endpoints</b><br/>‚Ä¢ /api/user/* - User operations<br/>‚Ä¢ /api/admin/* - Admin operations<br/>‚Ä¢ /api/store/* - Store operations<br/>‚Ä¢ Authentication, Orders, Cart, Products, etc."]

            MongoDB["<b>üçÉ MongoDB Database</b><br/>‚Ä¢ Users Collection<br/>‚Ä¢ Orders Collection<br/>‚Ä¢ Stores Collection<br/>‚Ä¢ Products Collection<br/>‚Ä¢ Cart Collection<br/>‚Ä¢ Transactions Collection"]

            %% Internal connections in ZMall Server
            ServerURLs --> APIs
            APIs --> MongoDB
        end

        subgraph PaymentAgg["üí≥ Payment Aggregator Separate Service"]
            PaymentInfo["‚Ä¢ Base URL: http://196.189.44.60/<br/>‚Ä¢ Handles payment gateway integrations<br/>‚Ä¢ Payment processing endpoints<br/>‚Ä¢ Telebirr, Chapa, EthSwitch, Amole, etc."]
        end
    end

    subgraph TIER3[" "]
        direction TB
        T3_Title["<b>TIER 3: FIREBASE & CLOUD SERVICES</b>"]

        subgraph Firebase["üî• Firebase Services Project: zmall-184809"]
            ActiveServices["<b>Active Services In Use:</b><br/>üîî Cloud Messaging FCM<br/>üìä Analytics + Events"]
            InactiveServices["<b>Integrated but Not Used:</b><br/>üîó Dynamic Links Configured"]

            %% Internal connections in Firebase
            ActiveServices -.-> InactiveServices
        end
    end

    subgraph TIER4[" "]
        direction TB
        T4_Title["<b>MOBILE APPLICATION LAYER</b>"]

        subgraph FlutterApp["üì± ZMall Flutter App v3.2.3+340"]

            Presentation["<b>PRESENTATION LAYER lib/</b><br/><b>Feature Modules:</b><br/>‚Ä¢ Splash & Onboarding ‚Ä¢ Shopping Cart<br/>‚Ä¢ Login/Register OTP ‚Ä¢ Checkout & Orders<br/>‚Ä¢ Home Local Market ‚Ä¢ Delivery Tracking<br/>‚Ä¢ Global Marketplace ‚Ä¢ Wallet Borsa<br/>‚Ä¢ Store Browsing ‚Ä¢ Profile Management<br/>‚Ä¢ Product Details ‚Ä¢ Event Booking<br/>‚Ä¢ Search ‚Ä¢ World Cup Special<br/>‚Ä¢ Notifications ‚Ä¢ AliExpress Integration<br/>‚Ä¢ Courier Service ‚Ä¢ Support Chat"]

            Business["<b>BUSINESS LOGIC LAYER</b><br/>‚Ä¢ service.dart - Main service handler<br/>‚Ä¢ core_services.dart - API integration<br/>‚Ä¢ biometric_services/ - Biometric auth<br/>‚Ä¢ firebase_core_services.dart - Firebase utils<br/>‚Ä¢ State Management Provider"]

            DataLayer["<b>DATA LAYER</b><br/>Models: User, Cart, Order, Store, Product, Language, etc.<br/><br/><b>Local Storage:</b><br/>‚Ä¢ SharedPreferences - App data, cart, cached content<br/>‚Ä¢ Flutter Secure Storage - Encrypted biometric credentials"]

            Security["<b>SECURITY & AUTHENTICATION</b><br/>‚Ä¢ Biometric Auth Face ID, Touch ID, Fingerprint<br/>‚Ä¢ OTP Verification SMS<br/>‚Ä¢ Multi-Account Support<br/>‚Ä¢ Encrypted Credential Storage<br/>‚Ä¢ Device Token Management"]

            Platforms["<b>Platforms:</b> iOS 15.0+ | Android SDK 36"]

            %% Internal connections in Flutter App
            Presentation --> Business
            Business --> DataLayer
            Business --> Security
        end
    end

    %% Main tier connections (Top to Bottom)
    TIER1 --> TIER2
    TIER2 --> TIER3
    TIER3 --> TIER4

    %% Cross-tier specific connections
    Internet -.-> FlutterApp
    PaymentGateways -.-> PaymentAgg
    FlutterApp --> ZMallServer
    FlutterApp --> PaymentAgg
    FlutterApp --> Firebase

    %% Styling
    classDef tier1Style fill:#FFE4B5,stroke:#FF8C00,stroke-width:4px
    classDef tier2Style fill:#B0E0E6,stroke:#4682B4,stroke-width:4px
    classDef tier3Style fill:#FFB6C1,stroke:#DC143C,stroke-width:4px
    classDef tier4Style fill:#98FB98,stroke:#228B22,stroke-width:4px
    classDef boxStyle fill:#FFF,stroke:#666,stroke-width:2px

    class TIER1 tier1Style
    class TIER2 tier2Style
    class TIER3 tier3Style
    class TIER4 tier4Style
    class ExtConn,PaymentGateways,GoogleSocial,ZMallServer,PaymentAgg,Firebase,FlutterApp boxStyle
